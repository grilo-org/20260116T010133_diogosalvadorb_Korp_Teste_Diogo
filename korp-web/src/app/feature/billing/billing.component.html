<div class="billing-container">
  <div
    class="header-area d-flex justify-content-between align-items-start mb-4"
  >
    <div>
      <h3 class="page-title">Notas Fiscais</h3>
      <p class="page-subtitle">Crie e gerencie suas notas fiscais.</p>
    </div>

    <button class="btn btn-primary new-invoice-btn" (click)="createInvoice()">
      <i class="fa-solid fa-plus me-2"></i>
      Nova Nota Fiscal
    </button>
  </div>

  <div class="invoice-card">
    <div class="d-flex align-items-center gap-2 section-title">
      <i class="fa-regular fa-file-lines"></i>
      <span class="fw-semibold">Lista de Notas Fiscais</span>
    </div>

    <div *ngIf="isLoading" class="loading-text mt-3">
      Carregando notas fiscais...
    </div>

    <div *ngIf="!isLoading && invoices.length === 0" class="empty-card">
      <i class="fa-regular fa-file-lines empty-icon"></i>
      <h5 class="empty-title mt-3">Nenhuma nota fiscal cadastrada</h5>
      <p class="empty-description">
        Crie sua primeira nota fiscal usando o botão acima.
      </p>
    </div>

    <div
      class="table-responsive mt-3"
      *ngIf="!isLoading && invoices.length > 0"
    >
      <table class="table align-middle modern-table">
        <thead>
          <tr>
            <th>Número</th>
            <th>Status</th>
            <th>Itens</th>
            <th>Data Criação</th>
            <th>Total</th>
            <th class="actions-header text-end">AÇÕES</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let inv of invoices">
            <td class="fw-semibold">#{{ inv.number | number : "0.0" }}</td>

            <td>
              <span class="status-badge" [ngClass]="getStatusClass(inv.status)">
                {{ getStatusLabel(inv.status) }}
              </span>
            </td>

            <td>
              <span class="item-badge">{{ inv.items.length }}</span>
            </td>

            <td>{{ inv.formattedDate }}</td>

            <td>{{ inv.formattedTotal }}</td>

            <td class="text-end actions-col">
              <button class="action-btn" (click)="viewInvoice(inv)">
                <i class="fa-regular fa-eye"></i>
              </button>

              <button
                class="action-btn"
                [class.disabled]="!inv.canPrint"
                [disabled]="!inv.canPrint"
                (click)="printInvoice(inv)"
              >
                <i class="fa-solid fa-print"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<app-create-invoice-modal
  *ngIf="showCreateModal"
  (onCancel)="showCreateModal = false"
  (onConfirm)="saveInvoice($event)">
</app-create-invoice-modal>

<app-invoice-print
  *ngIf="isPrintModalOpen"
  [invoice]="selectedInvoice"
  [showPrintButton]="showPrintButton"
  (close)="isPrintModalOpen = false">
</app-invoice-print>
